<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple Computer//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>beforeRunningCommand</key>
	<string>nop</string>
	<key>command</key>
	<string>#!/usr/bin/env ruby

SUPPORT = ENV['TM_SUPPORT_PATH']
DIALOG = SUPPORT + '/bin/tm_dialog'

require SUPPORT + '/lib/escape'
require SUPPORT + '/lib/exit_codes'
require SUPPORT + '/lib/osx/plist'
require 'rexml/document'

ant_targets = []

source = REXML::Document.new(STDIN.read)
source.each_element('//target') {|targ| ant_targets.push( { 'title' =&gt; targ.attributes['name'] } )}

ant_targets = ant_targets.sort {| a,b | a['title'] &lt;=&gt;  b['title'] }

plist = { 'menuItems' =&gt; ant_targets }.to_plist

res = OSX::PropertyList::load(`#{e_sh DIALOG} -up #{e_sh plist}`)

TextMate.exit_discard() unless res.has_key? 'selectedMenuItem'

selected_target = res['selectedMenuItem']['title']

#TextMate.exit_show_tool_tip( "TODO: run" + selected_target )

`ant -find #{ENV["TM_FILEPATH"]} #{selected_target}`

#TextMate.exit_show_html()


</string>
	<key>fallbackInput</key>
	<string>document</string>
	<key>input</key>
	<string>selection</string>
	<key>keyEquivalent</key>
	<string>@B</string>
	<key>name</key>
	<string>Build (target)</string>
	<key>output</key>
	<string>showAsHTML</string>
	<key>scope</key>
	<string>text.xml.ant</string>
	<key>uuid</key>
	<string>05BC9A24-B64E-42D6-8177-326518E65EE0</string>
</dict>
</plist>
